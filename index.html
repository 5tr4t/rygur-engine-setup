<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rygur Engine - Operations Diagnostic</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
<style>
  /* Basic styling from previous code */
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    min-height: 100vh;
    color: #333;
    padding: 20px;
    display: flex;
    justify-content: center;
  }
  .container {
    width: 900px;
    background: white;
    border-radius: 16px;
    padding: 40px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
  }
  h1 {
    font-size: 2.4em;
    font-weight: 700;
    text-align: center;
    margin-bottom: 6px;
  }
  h2.subheading {
    text-align: center;
    color: #555555;  /* Dark grey */
    font-weight: 600;
    font-size: 1em;  /* Smaller font */
    margin-bottom: 40px; /* Increased space */
  }
  hr {
    border: none;
    border-bottom: 2px solid #f1f3f4;
    margin-bottom: 30px;
  }
  .card {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 30px 35px;
    margin-bottom: 40px;
  }
  .card h3 {
    color: #00D1FF;
    font-size: 1.5em;
    margin-bottom: 25px;
    font-weight: 600;
  }
  .form-group {
    margin-bottom: 18px;
  }
  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
  }
  input[type="text"], input[type="email"], select, input[type="number"] {
    width: 100%;
    padding: 12px 14px;
    font-size: 1em;
    border-radius: 8px;
    border: 2px solid #dbdfe7;
  }
  input[type="email"]:focus, input[type="text"]:focus, select:focus, input[type="number"]:focus {
    outline: none;
    border-color: #00D1FF;
    box-shadow: 0 0 0 3px rgba(0, 209, 255, 0.1);
  }
  .error-msg {
    color: #ea1f30;
    font-weight: 600;
    margin-top: 5px;
    font-size: 0.9em;
    display: none;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 24px;
    font-size: 14px;
    color: #555;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 10px 8px;
    text-align: center;
    vertical-align: middle;
  }
  th {
    background: #e9f5fc;
    font-weight: 600;
  }
  td:first-child {
    text-align: left;
    font-weight: 600;
  }
  input.weight-input {
    width: 80px;
    padding: 6px;
    text-align: center;
    border-radius: 6px;
    border: 1.5px solid #dbdfe7;
  }
  .modify-question {
    font-weight: 600;
    margin-bottom: 10px;
  }
  .radio-group {
    margin-bottom: 25px;
  }
  .radio-group label {
    margin-right: 25px;
    font-weight: normal;
    cursor: pointer;
  }
  button#submitBtn {
    background: linear-gradient(135deg, #00D1FF 0%, #0099cc 100%);
    color: white;
    padding: 16px 50px;
    font-weight: 700;
    font-size: 18px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    box-shadow: 0 6px 15px rgba(0, 209, 255, 0.3);
    display: block;
    margin: 40px auto 0;
  }
  button#submitBtn:disabled {
    background: #ccc;
    cursor: not-allowed;
    box-shadow: none;
  }
  /* Result display */
  #resultSection {
    display: none;
    text-align: center;
    margin-top: 60px;
  }
</style>
</head>
<body>

<div class="container" id="formContainer">
  <h1>Rygur Engine - Operations Diagnostic</h1>
  <h2 class="subheading">Set up the survey for your company's assessment.</h2>
  <hr>

  <div class="card" id="companyInfoCard">
    <h3>Company Information</h3>
    <div class="form-group">
      <label for="companyName">Company Name *</label>
      <input type="text" id="companyName" name="companyName" required />
      <p class="error-msg" id="emailError" style="display:none;">Please enter a valid email address.</p>
    </div>
    <div class="form-group">
      <label for="companyStage">Company Stage *</label>
      <select id="companyStage" name="companyStage" required>
        <option value="">Select Stage</option>
        <option value="startup">Startup</option>
        <option value="scaleup">Scale-up</option>
        <option value="mature">Mature</option>
      </select>
    </div>
    <div class="form-group">
      <label for="respondents">Number of Respondents *</label>
      <input type="number" id="respondents" name="respondents" min="1" required />
    </div>
    <div class="form-group">
      <label for="submitterEmail">Submitter's Email *</label>
      <input type="email" id="submitterEmail" name="submitterEmail" required />
    </div>
  </div>

  <div class="card" id="pillarWeightsCard">
    <h3>Pillar Weights</h3>
    <table aria-label="Default Pillar Weights by Stage">
      <thead>
        <tr>
          <th>Pillar</th><th>Start-up (prove + survive)</th><th>Scale-up (stabilise + grow)</th><th>Mature (optimise + sustain)</th><th>Rationale</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>Leadership & Culture</td><td>20%</td><td>15%</td><td>10%</td><td>Early on, leadership clarity, vision, and culture are everything. As systems mature, leadership matters more for alignment than survival.</td></tr>
        <tr><td>Performance & Governance</td><td>10%</td><td>15%</td><td>20%</td><td>In start-ups, formal governance slows speed. In scale-up, governance brings discipline. By mature stage, itâ€™s the backbone of control and accountability.</td></tr>
        <tr><td>Structure, Roles & Responsibilities</td><td>10%</td><td>15%</td><td>20%</td><td>Start-ups rely on generalists; structure emerges later. In maturity, clear roles and succession planning become critical for resilience.</td></tr>
        <tr><td>Process Discipline</td><td>10%</td><td>20%</td><td>20%</td><td>At the beginning, agility &gt; process. As you scale, repeatability and optimisation determine efficiency and margin.</td></tr>
        <tr><td>Technology & Enablement</td><td>40%</td><td>20%</td><td>10%</td><td>Start-ups depend heavily on enabling tech to punch above their weight. As they grow, tech becomes table stakes, not differentiator.</td></tr>
        <tr><td>Risk & Resilience</td><td>10%</td><td>15%</td><td>20%</td><td>Low formal risk management early on; it ramps up with customer/regulatory exposure. Mature firms rely on strong resilience and controls.</td></tr>
      </tbody>
    </table>

    <div class="modify-question">Would you like to modify these weights for your organisation?</div>
    <div class="radio-group">
      <label><input type="radio" name="modifyWeights" value="no" checked> No</label>
      <label><input type="radio" name="modifyWeights" value="yes"> Yes</label>
    </div>

    <table aria-label="Editable Pillar Weights" id="editWeightsTable" style="display:none; margin-top: 15px; border-collapse: collapse; width: 100%;">
      <thead>
        <tr>
          <th>Pillar</th><th>Start-up (prove + survive)</th><th>Scale-up (stabilise + grow)</th><th>Mature (optimise + sustain)</th><th>Preferred Weight (%) *</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Leadership & Culture</td>
          <td>20%</td><td>15%</td><td>10%</td>
          <td><input type="number" class="weight-input" id="inputLeadership" min="0" max="100" required /></td>
        </tr>
        <tr>
          <td>Performance & Governance</td>
          <td>10%</td><td>15%</td><td>20%</td>
          <td><input type="number" class="weight-input" id="inputPerformance" min="0" max="100" required /></td>
        </tr>
        <tr>
          <td>Structure, Roles & Responsibilities</td>
          <td>10%</td><td>15%</td><td>20%</td>
          <td><input type="number" class="weight-input" id="inputStructure" min="0" max="100" required /></td>
        </tr>
        <tr>
          <td>Process Discipline</td>
          <td>10%</td><td>20%</td><td>20%</td>
          <td><input type="number" class="weight-input" id="inputProcess" min="0" max="100" required /></td>
        </tr>
        <tr>
          <td>Technology & Enablement</td>
          <td>40%</td><td>20%</td><td>10%</td>
          <td><input type="number" class="weight-input" id="inputTechnology" min="0" max="100" required /></td>
        </tr>
        <tr>
          <td>Risk & Resilience</td>
          <td>10%</td><td>15%</td><td>20%</td>
          <td><input type="number" class="weight-input" id="inputRisk" min="0" max="100" required /></td>
        </tr>
        <tr>
          <td colspan="4" style="text-align:right; font-weight: bold;">Total:</td>
          <td id="weightsTotal">0</td>
        </tr>
      </tbody>
    </table>
    <div id="weightError" class="error-msg">Weights should add to 100%</div>
  </div>

  <div style="text-align:center; margin-top: 40px;">
    <input type="hidden" id="uniqueCode" name="uniqueCode" />
    <button id="submitBtn" disabled>Submit Survey</button>
  </div>
</div>

<script>
  const modifyRadios = document.getElementsByName('modifyWeights');
  const editWeightsTable = document.getElementById('editWeightsTable');
  const weightInputs = document.querySelectorAll('.weight-input');
  const weightsTotalDisplay = document.getElementById('weightsTotal');
  const weightError = document.getElementById('weightError');
  const submitBtn = document.getElementById('submitBtn');

  const companyFields = [
    document.getElementById('companyName'),
    document.getElementById('companyStage'),
    document.getElementById('respondents'),
    document.getElementById('submitterEmail')
  ];

  function isValidEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }

  function validateCompanyInfo() {
    let valid = true;
    const emailField = document.getElementById('submitterEmail');
    const emailError = document.getElementById('emailError');

    companyFields.forEach(field => {
      if (!field.value.trim()) valid = false;
    });

    if (!isValidEmail(emailField.value.trim())) {
      emailError.style.display = 'block';
      valid = false;
    } else {
      emailError.style.display = 'none';
    }

    return valid;
  }

  function isWeightsValid() {
    let total = 0;
    weightInputs.forEach(input => {
      const val = parseFloat(input.value);
      if (!isNaN(val)) {
        total += val;
      }
    });
    weightsTotalDisplay.textContent = total.toFixed(1);
    const ok = (total === 100);
    weightError.style.display = ok ? 'none' : 'block';
    return ok;
  }

  function validateWeights() {
    isWeightsValid(); 
    updateSubmitButtonState();
  }

  function updateUI() {
    const selected = Array.from(modifyRadios).find(r => r.checked).value;
    if(selected === 'yes') {
      editWeightsTable.style.display = 'table';
      validateWeights();
    } else {
      editWeightsTable.style.display = 'none';
      weightError.style.display = 'none';
      submitBtn.disabled = false;
    }
  }

  function updateSubmitButtonState() {
    const companyOk = validateCompanyInfo();
    let weightsOk = true;
    if (document.querySelector('input[name="modifyWeights"]:checked').value === 'yes') {
      weightsOk = isWeightsValid();
    }
    submitBtn.disabled = !(companyOk && weightsOk);
  }

  modifyRadios.forEach(radio => {
    radio.addEventListener('change', () => {
      updateUI();
      updateSubmitButtonState();
    });
  });

  weightInputs.forEach(input => {
    input.addEventListener('input', validateWeights);
  });

  companyFields.forEach(field => {
    field.addEventListener('input', updateSubmitButtonState);
  });

  function generateCode() {
    const cname = document.getElementById('companyName').value.trim();
    const prefix = (cname.match(/[a-zA-Z]/g) || ['X','X','X']).slice(0,3).join('').toUpperCase();
    const now = new Date();
    const pad = n => n.toString().padStart(2,'0');
    return `${prefix}${now.getFullYear()}${pad(now.getMonth()+1)}${pad(now.getDate())}` +
           `-${pad(now.getHours())}${pad(now.getMinutes())}${pad(now.getSeconds())}`;
  }

  submitBtn.addEventListener('click', () => {
    const codeField = document.getElementById('uniqueCode');
    codeField.value = generateCode();

    const data = {
      companyName: document.getElementById('companyName').value,
      companyStage: document.getElementById('companyStage').value,
      respondents: document.getElementById('respondents').value,
      submitterEmail: document.getElementById('submitterEmail').value,
      uniqueCode: codeField.value,
      weights: {}
    };

    if(document.querySelector('input[name="modifyWeights"]:checked').value === 'yes') {
      weightInputs.forEach(input => {
        data.weights[input.id.replace('input', '')] = input.value;
      });
    } else {
      // Provide defaults if user didn't modify (mirror table defaults)
      data.weights = {
        Leadership: "15",
        Performance: "15",
        Structure: "15",
        Process: "20",
        Technology: "20",
        Risk: "15"
      };
    }

    fetch('https://str4t.app.n8n.cloud/webhook-test/6c4856d9-50b2-4adf-b1f7-f4ce35752ebc', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(res => {
      // Display success message and survey link page
      document.getElementById('formContainer').innerHTML = `
        <h1>We have generated your unique survey link:</h1>
        <p><a href="https://example.com/survey/${codeField.value}" target="_blank" rel="noopener noreferrer">Operations Diagnostic</a></p>
        <p>Please share this with your team for responses. Note that we expect ${data.respondents} response(s) before we generate your report.</p>
        <p>We have sent you an email with this link to forward to your survey respondents.</p>
      `;
    })
    .catch(err => {
      alert('There was an error submitting the survey. Please try again.');
      console.error(err);
    });
  });

  window.addEventListener('DOMContentLoaded', () => {
    updateUI();
    updateSubmitButtonState();
  });
</script>

</body>
</html>
